<!DOCTYPE html>
<html>
<head>
  <title>Example</title>
  <style type="text/css">
    .pre {
      font-family: monospace;
      white-space: pre;
    }
  </style>

</head>
<body>
<input name="txt" id="txt" type="file">
<pre id="out"></pre>
<pre id="report"></pre>
  <script>
    var fileInput = document.getElementById('txt')
    var reader = new FileReader()
    var report = document.getElementById('report')
    var output = document.getElementById('out')
    var fileHeader
    var userData = []

    function processFile () {

      reader.onload = function (event) {
        var contents = reader.result
        var lines = contents.split('\n')
        for (var i = 0; i < lines.length; i++) {
          if (i === 0) {
            fileHeader = lines[i].split(',')
          } else {
            userData[i] = lines[i].split(',')
            var newText = document.createTextNode(userData[i].join(' ') + '\n')
            output.appendChild(newText)
          }
        }

        buildReportQ()
      }

      reader.readAsBinaryString(fileInput.files[0])
    }

    function buildSelect (id, none) {
      var html = '<select id="' + id + '">'
      if (none) {
        html = html + '<option>None</option>'
      }
      fileHeader.forEach(function (attr) {
        html = html + '\n<option value="' + attr + '">' + attr + '</option>'
      })
      html = html + '\n</select>'
      return html
    }

    function buildReportQ () {
      var reportQ = 'SELECT ATTRIBUTE: ' + buildSelect('attribute', false) +
        '\nSELECT OPERATION: <select name="operation"><option>SUM</option><option>AVERAGE</option></select>' +
        '\nSELECT GROUPING: ' + buildSelect('groupby', true)
      report.innerHTML = reportQ
    }

    fileInput.addEventListener('change', processFile)
  </script>
</body>
</html>